openapi: 3.1.0
info:
  title: "Contact Service REST API"
  version: "1.0"

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    UserRole:
      type: string
      enum: [ USER, ADMIN, SUPERADMIN ]
      description: User role

    PreferredChannel:
      type: string
      enum: [ email, sms, telegram ]
      description: Preferred notification channel

  ## -------------------- COMMON ERROR SCHEMAS --------------------
    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
      required: [ code, message ]

    ValidationErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
        - type: object
          properties:
            details:
              type: array
              items:
                $ref: '#/components/schemas/ErrorDetail'
    ErrorDetail:
      type: object
      properties:
        field:
          type: string
        error:
          type: string

    ## -------------------- RABBIT SCHEMAS ---------------------------
    UserCreatedEventPayload:
      type: object
      description: Payload for routing key 'user.user_created'.
      additionalProperties: false
      required: [ accountUuid, email ]
      properties:
        accountUuid:
          type: string
          description: UUID of the account in auth-service.
          example: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
        email:
          type: string
          format: email
          description: User email.
          example: "user@example.com"

    UserDeletedEventPayload:
      type: object
      description: Payload for routing key 'user.user_deleted'.
      additionalProperties: false
      required: [ accountUuid ]
      properties:
        accountUuid:
          type: string
          description: UUID of the account in auth-service.
          example: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"

    ## -------------------- PROFILE SCHEMAS ---------------------------
    UserProfileResponse:
      type: object
      additionalProperties: false
      required:
        - email
        - preferredChannel
        - createdAt
        - updatedAt
      properties:
        surname:
          type: string
          example: "Doe"
        name:
          type: string
          example: "John"
        email:
          type: string
          example: "user@example.com"
        telegramUsername:
          type: string
          example: "john_doe"
        phoneNumber:
          type: string
          example: "+420123456789"
        city:
          type: string
          example: "Prague"
        countryCode:
          type: string
          description: ISO 3166-1 alpha-2
          example: "CZ"
        preferredChannel:
          $ref: '#/components/schemas/PreferredChannel'
        createdAt:
          type: string
          format: date-time
          example: "2025-09-16T12:34:56Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-09-16T12:45:10Z"


    UserProfileUpdateRequest:
      type: object
      additionalProperties: false
      minProperties: 1
      description: Fields that can be updated by the profile owner
      properties:
        surname:
          type: string
        name:
          type: string
        telegramUsername:
          type: string
        phoneNumber:
          type: string
        city:
          type: string
        countryCode:
          type: string
          pattern: "^[A-Z]{2}$"
          description: ISO 3166-1 alpha-2
        preferredChannel:
          $ref: '#/components/schemas/PreferredChannel'

    UserProfileForAdminResponse:
      type: object
      additionalProperties: false
      required:
        - id
        - userProfileUuid
        - authAccountUuid
        - email
        - preferredChannel
        - createdAt
        - updatedAt
      properties:
        id:
          type: integer
          example: 42
          readOnly: true
        userProfileUuid:
          type: string
          description: Public UUID of the profile
          example: "5f4d3c2b-1a09-4e8f-b7c6-1a2b3c4d5e6f"
          readOnly: true
        authAccountUuid:
          type: string
          description: UUID of the linked auth account
          example: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
          readOnly: true
        surname:
          type: string
          example: "Doe"
        name:
          type: string
          example: "John"
        email:
          type: string
          format: email
          example: "user@example.com"
        telegramUsername:
          type: string
          example: "john_doe"
        phoneNumber:
          type: string
          example: "+420123456789"
        city:
          type: string
          example: "Prague"
        countryCode:
          type: string
          pattern: "^[A-Z]{2}$"
          description: ISO 3166-1 alpha-2
          example: "CZ"
        preferredChannel:
          $ref: '#/components/schemas/PreferredChannel'
        createdAt:
          type: string
          format: date-time
          example: "2025-09-16T12:34:56Z"
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          example: "2025-09-16T12:45:10Z"
          readOnly: true

    ## -------------------- GROUP SCHEMAS ---------------------------
    GroupForMeResponse:
      type: object
      additionalProperties: false
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
          example: "On-call Team"
        description:
          type: string
          example: "Primary incident responders"
        createdAt:
          type: string
          format: date-time
          example: "2025-09-16T10:00:00Z"

    GroupMemberForAdminResponse:
      type: object
      additionalProperties: false
      required:
        - userProfileUuid
        - authAccountUuid
        - email
        - preferredChannel
        - joinedAt
      properties:
        id:
          type: integer
          format: int64
          example: 42
        userProfileUuid:
          type: string
          example: "5f4d3c2b-1a09-4e8f-b7c6-1a2b3c4d5e6f"
        authAccountUuid:
          type: string
          example: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
        surname:
          type: string
          example: "Doe"
        name:
          type: string
          example: "John"
        email:
          type: string
          format: email
          example: "john@example.com"
        telegramUsername:
          type: string
          example: "john_doe"
        phoneNumber:
          type: string
          example: "+420123456789"
        city:
          type: string
          example: "Prague"
        countryCode:
          type: string
          description: ISO 3166-1 alpha-2
          example: "CZ"
        preferredChannel:
          $ref: '#/components/schemas/PreferredChannel'
        createdAt:
          type: string
          format: date-time
          description: Profile creation timestamp
          example: "2025-09-10T08:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Profile update timestamp
          example: "2025-09-16T10:00:00Z"
        joinedAt:
          type: string
          format: date-time
          description: Timestamp when the profile joined the group
          example: "2025-09-16T10:05:00Z"

    GroupForAdminResponse:
      type: object
      additionalProperties: false
      required:
        - id
        - contactGroupUuid
        - name
        - createdByAccountUuid
        - createdAt
      properties:
        id:
          type: integer
          example: 12
        contactGroupUuid:
          type: string
          example: "9d5f1c2b-7a30-4e1a-bc88-2f4a6b7c8d90"
        name:
          type: string
          example: "On-call Team"
        description:
          type: string
          example: "Primary incident responders"
        createdByAccountUuid:
          type: string
          example: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
        createdAt:
          type: string
          format: date-time
          example: "2025-09-16T10:00:00Z"

    GroupUpdateRequest:
      type: object
      additionalProperties: false
      description: Fields that can be updated by an admin
      minProperties: 1
      properties:
        name:
          type: string
        description:
          type: string

    GroupCreateRequest:
      type: object
      additionalProperties: false
      required: [ name ]
      properties:
        name:
          type: string
        description:
          type: string

    TemplateTargetsForAdminResponse:
      type: array
      items:
        $ref: '#/components/schemas/GroupForAdminResponse'


  ## -------------------- NOTIFICATION TEMPLATES SCHEMAS ---------------------------
    NotificationTemplateResponse:
      type: object
      required:
        - notificationTemplateUuid
        - title
        - channel
        - createdByAccountUuid
        - createdAt
      properties:
        notificationTemplateUuid:
          type: string
          example: "3f2b7a9c-1d4e-4f7a-9c2b-5a6d7e8f9a0b"
        title:
          type: string
          example: "Outage alert"
        body:
          type: string
          example: "Hello {{name}}, we detected an outage in {{city}} at {{time}}."
        channel:
          type: string
          example: "email"
        createdByAccountUuid:
          type: string
          example: "9a8b7c6d-5e4f-3a2b-1c0d-ef1234567890"
        createdAt:
          type: string
          format: date-time
          example: "2025-09-16T10:00:00Z"

    NotificationTemplatePatchRequest:
      type: object
      additionalProperties: false
      minProperties: 1
      properties:
        title:
          type: string
          example: "Outage alert v2"
        body:
          type: string
          example: "Hi {{name}}, outage in {{city}} since {{time}}. We are on it."
        channel:
          type: string
          example: "sms"

    NotificationTemplateCreateRequest:
      type: object
      additionalProperties: false
      required:
        - title
        - body
        - channel
      properties:
        title:
          type: string
          example: "Outage alert"
        body:
          type: string
          example: "Hello {{name}}, we detected an outage in {{city}} at {{time}}."
        channel:
          type: string
          example: "email"




  examples:
    MissingFields:
      summary: Missing required field
      value:
        code: 400
        message: "Missing required field."
    ValidationFailed:
      summary: Validation failed
      value:
        code: 422
        message: "Validation failed."
        details:
          - field: "countryCode"
            error: "Must be a 2-letter ISO code."
    Unauthorized:
      summary: Missing or invalid token
      value:
        code: 401
        message: "Unauthorized."
    Forbidden:
      summary: Insufficient role
      value:
        code: 403
        message: "Forbidden."
    NotFound:
      summary: Resource not found
      value:
        code: 404
        message: "Resource not found."
    GroupExists:
      summary: Group already exists
      value:
        code: 409
        message: "Group with this name already exists."
    TemplateExists:
      summary: Template already exists
      value:
        code: 409
        message: "Template with this title and channel already exists."
    InternalError:
      summary: Unexpected server error
      value:
        code: 500
        message: "Internal server error."

paths:
  /profiles/me:
    get:
      tags: [ Profiles ]
      summary: Get current user's profile
      operationId: getMyProfile
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
              examples:
                profile:
                  value:
                    surname: "Doe"
                    name: "John"
                    email: "user@example.com"
                    telegramUsername: "john_doe"
                    phoneNumber: "+420123456789"
                    city: "Prague"
                    countryCode: "CZ"
                    preferredChannel: "email"
                    createdAt: "2025-09-16T12:34:56Z"
                    updatedAt: "2025-09-16T12:45:10Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  $ref: '#/components/examples/Unauthorized'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  $ref: '#/components/examples/NotFound'
        '500':
          description: Internal error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                internal:
                  $ref: '#/components/examples/InternalError'

    patch:
      tags: [ Profiles ]
      summary: Update current user's profile
      operationId: updateMyProfile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileUpdateRequest'
            examples:
              update:
                value:
                  surname: "Doe"
                  name: "John"
                  telegramUsername: "john_doe"
                  phoneNumber: "+420123456789"
                  city: "Plzeň"
                  countryCode: "CZ"
                  preferredChannel: "telegram"
          application/merge-patch+json:
            schema:
              $ref: '#/components/schemas/UserProfileUpdateRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorized:
                  $ref: '#/components/examples/Unauthorized'
        '422':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              examples:
                validation:
                  $ref: '#/components/examples/ValidationFailed'
        '500':
          description: Internal error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                internal:
                  $ref: '#/components/examples/InternalError'

  /profiles/{profileUuid}:
    parameters:
      - name: profileUuid
        in: path
        required: true
        description: Public UUID of the user profile
        schema:
          type: string

    get:
      tags: [ Profiles ]
      summary: Get user profile by UUID (admin)
      operationId: adminGetProfileByUuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileForAdminResponse'
              examples:
                profile:
                  value:
                    id: 42
                    userProfileUuid: "5f4d3c2b-1a09-4e8f-b7c6-1a2b3c4d5e6f"
                    authAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                    surname: "Doe"
                    name: "John"
                    email: "user@example.com"
                    telegramUsername: "john_doe"
                    phoneNumber: "+420123456789"
                    city: "Prague"
                    countryCode: "CZ"
                    preferredChannel: "email"
                    createdAt: "2025-09-16T12:34:56Z"
                    updatedAt: "2025-09-16T12:45:10Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    patch:
      tags: [ Profiles ]
      summary: Update user profile by UUID (admin)
      operationId: adminUpdateProfileByUuid
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UserProfileUpdateRequest' }
            examples:
              update:
                value:
                  surname: "Doe"
                  name: "John"
                  telegramUsername: "john_doe"
                  phoneNumber: "+420123456789"
                  city: "Plzeň"
                  countryCode: "CZ"
                  preferredChannel: "sms"
          application/merge-patch+json:
            schema: { $ref: '#/components/schemas/UserProfileUpdateRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileForAdminResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '422':
          description: Validation failed
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ValidationErrorResponse' }
              examples:
                validation: { $ref: '#/components/examples/ValidationFailed' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /groups:
    post:
      tags: [ Groups ]
      summary: Create a group (admin)
      operationId: adminCreateGroup
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/GroupCreateRequest' }
            examples:
              create:
                value:
                  name: "On-call Team"
                  description: "Primary incident responders"
      responses:
        '201':
          description: Group created
          headers:
            Location:
              description: URL of the created group
              schema:
                type: string
                example: /groups/9d5f1c2b-7a30-4e1a-bc88-2f4a6b7c8d90
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupForAdminResponse'
              examples:
                group:
                  value:
                    id: 12
                    contactGroupUuid: "9d5f1c2b-7a30-4e1a-bc88-2f4a6b7c8d90"
                    name: "On-call Team"
                    description: "Primary incident responders"
                    createdByAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                    createdAt: "2025-09-16T10:00:00Z"
        '400':
          description: Missing fields
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                missing: { $ref: '#/components/examples/MissingFields' }
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '409':
          description: Conflict
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                conflict: { $ref: '#/components/examples/GroupExists' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /groups/me:
    get:
      tags: [ Groups ]
      summary: Get groups where current user is a member
      operationId: getMyGroups
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GroupForMeResponse'
              examples:
                groupsList:
                  value:
                    - name: "On-call Team"
                      description: "Primary incident responders"
                      createdAt: "2025-09-16T10:00:00Z"
                    - name: "Security Alerts"
                      description: "Security notifications"
                      createdAt: "2025-09-10T08:30:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /groups/{groupUuid}/members:
    parameters:
      - name: groupUuid
        in: path
        required: true
        description: Public UUID of the group
        schema:
          type: string
      - name: page
        in: query
        required: false
        description: Zero-based page index
        schema:
          type: integer
          default: 0
      - name: size
        in: query
        required: false
        description: Page size
        schema:
          type: integer
          default: 50

    get:
      tags: [ Groups ]
      summary: Get members of a group (admin)
      operationId: adminGetGroupMembers
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GroupMemberForAdminResponse'
              examples:
                members:
                  value:
                    - id: 42
                      userProfileUuid: "5f4d3c2b-1a09-4e8f-b7c6-1a2b3c4d5e6f"
                      authAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                      surname: "Doe"
                      name: "John"
                      email: "john@example.com"
                      telegramUsername: "john_doe"
                      phoneNumber: "+420123456789"
                      city: "Prague"
                      countryCode: "CZ"
                      preferredChannel: "email"
                      createdAt: "2025-09-10T08:30:00Z"
                      updatedAt: "2025-09-16T10:00:00Z"
                      joinedAt: "2025-09-16T10:05:00Z"
                    - id: 77
                      userProfileUuid: "7aa2f0e1-3b19-4e77-9b9a-0a1b2c3d4e5f"
                      authAccountUuid: "9b8a7c6d-5e4f-3a2b-1c0d-9e8f7a6b5c4d"
                      surname: "Smith"
                      name: "Alice"
                      email: "alice@example.com"
                      telegramUsername: "alice_s"
                      phoneNumber: "+420987654321"
                      city: "Brno"
                      countryCode: "CZ"
                      preferredChannel: "telegram"
                      createdAt: "2025-09-05T12:00:00Z"
                      updatedAt: "2025-09-15T09:20:00Z"
                      joinedAt: "2025-09-16T10:06:12Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Group not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /groups/{groupUuid}:
    parameters:
      - name: groupUuid
        in: path
        required: true
        description: Public UUID of the group
        schema:
          type: string

    get:
      tags: [ Groups ]
      summary: Get group by UUID (admin)
      operationId: adminGetGroupByUuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupForAdminResponse'
              examples:
                group:
                  value:
                    id: 12
                    contactGroupUuid: "9d5f1c2b-7a30-4e1a-bc88-2f4a6b7c8d90"
                    name: "On-call Team"
                    description: "Primary incident responders"
                    createdByAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                    createdAt: "2025-09-16T10:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    patch:
      tags: [ Groups ]
      summary: Update group by UUID (admin)
      operationId: adminUpdateGroupByUuid
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/GroupUpdateRequest' }
            examples:
              updateName:
                value:
                  name: "On-call Team"
              updateDescription:
                value:
                  description: "Primary incident responders"
              updateBoth:
                value:
                  name: "On-call Team"
                  description: "Primary incident responders"
          application/merge-patch+json:
            schema: { $ref: '#/components/schemas/GroupUpdateRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupForAdminResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Group not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '409':
          description: Conflict (e.g., group with this name already exists)
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                conflict: { $ref: '#/components/examples/GroupExists' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    delete:
      tags: [ Groups ]
      summary: Delete group by UUID (admin)
      operationId: adminDeleteGroupByUuid
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Group not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /groups/{groupUuid}/members/{profileUuid}:
    parameters:
      - name: groupUuid
        in: path
        required: true
        description: Public UUID of the group
        schema:
          type: string
      - name: profileUuid
        in: path
        required: true
        description: Public UUID of the user profile
        schema:
          type: string

    head:
      tags: [ Groups ]
      summary: Check if profile is a member of the group (admin)
      operationId: adminCheckGroupMembership
      responses:
        '200':
          description: Member exists
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Group or profile not found, or membership absent
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    put:
      tags: [ Groups ]
      summary: Add profile to the group (admin)
      operationId: adminAddGroupMember
      parameters:
        - name: groupUuid
          in: path
          required: true
          description: Public UUID of the group
          schema: { type: string }
        - name: profileUuid
          in: path
          required: true
          description: Public UUID of the user profile
          schema: { type: string }
      responses:
        '201':
          description: Member created
          headers:
            Location:
              description: URL of the membership resource
              schema:
                type: string
                example: /groups/9d5f1c2b-7a30-4e1a-bc88-2f4a6b7c8d90/members/5f4d3c2b-1a09-4e8f-b7c6-1a2b3c4d5e6f
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupMemberForAdminResponse'
              examples:
                created:
                  value:
                    id: 42
                    userProfileUuid: "5f4d3c2b-1a09-4e8f-b7c6-1a2b3c4d5e6f"
                    authAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                    surname: "Doe"
                    name: "John"
                    email: "john@example.com"
                    telegramUsername: "john_doe"
                    phoneNumber: "+420123456789"
                    city: "Prague"
                    countryCode: "CZ"
                    preferredChannel: "email"
                    createdAt: "2025-09-10T08:30:00Z"
                    updatedAt: "2025-09-16T10:00:00Z"
                    joinedAt: "2025-09-16T10:05:00Z"
        '200':
          description: Already a member
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupMemberForAdminResponse'
              examples:
                alreadyMember:
                  value:
                    id: 42
                    userProfileUuid: "5f4d3c2b-1a09-4e8f-b7c6-1a2b3c4d5e6f"
                    authAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                    surname: "Doe"
                    name: "John"
                    email: "john@example.com"
                    telegramUsername: "john_doe"
                    phoneNumber: "+420123456789"
                    city: "Prague"
                    countryCode: "CZ"
                    preferredChannel: "email"
                    createdAt: "2025-09-10T08:30:00Z"
                    updatedAt: "2025-09-16T10:00:00Z"
                    joinedAt: "2025-08-01T09:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Group or profile not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    delete:
      tags: [ Groups ]
      summary: Remove profile from the group (admin)
      operationId: adminRemoveGroupMember
      parameters:
        - name: groupUuid
          in: path
          required: true
          description: Public UUID of the group
          schema: { type: string }
        - name: profileUuid
          in: path
          required: true
          description: Public UUID of the user profile
          schema: { type: string }
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Group or profile not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /templates:
    post:
      tags: [ Notification templates ]
      summary: Create template (admin)
      operationId: adminCreateTemplate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationTemplateCreateRequest'
            examples:
              createEmail:
                value:
                  title: "Outage alert"
                  body: "Hello {{name}}, we detected an outage in {{city}} at {{time}}."
                  channel: "email"
              createSms:
                value:
                  title: "Outage alert"
                  body: "Hi {{name}}, outage in {{city}} since {{time}}."
                  channel: "sms"
      responses:
        '201':
          description: Created
          headers:
            Location:
              description: URL of the created template resource
              schema: { type: string }
              example: /templates/3f2b7a9c-1d4e-4f7a-9c2b-5a6d7e8f9a0b
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationTemplateResponse'
              examples:
                created:
                  value:
                    notificationTemplateUuid: "3f2b7a9c-1d4e-4f7a-9c2b-5a6d7e8f9a0b"
                    title: "Outage alert"
                    body: "Hello {{name}}, we detected an outage in {{city}} at {{time}}."
                    channel: "email"
                    createdByAccountUuid: "9a8b7c6d-5e4f-3a2b-1c0d-ef1234567890"
                    createdAt: "2025-09-16T10:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '409':
          description: Conflict (e.g., duplicate title for the same owner)
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                conflict:
                  value:
                    timestamp: "2025-09-16T10:01:00Z"
                    status: 409
                    error: "Conflict"
                    message: "Template with the same title already exists."
                    path: "/templates"
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /templates/{templateUuid}:
    get:
      tags: [ Notification templates ]
      summary: Get template (admin)
      operationId: adminGetTemplate
      parameters:
        - name: templateUuid
          in: path
          required: true
          description: Public UUID of the template
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationTemplateResponse'
              examples:
                ok:
                  value:
                    notificationTemplateUuid: "3f2b7a9c-1d4e-4f7a-9c2b-5a6d7e8f9a0b"
                    title: "Outage alert"
                    body: "Hello {{name}},\nWe detected an outage in {{city}} at {{time}}."
                    channel: "email"
                    createdByAccountUuid: "9a8b7c6d-5e4f-3a2b-1c0d-ef1234567890"
                    createdAt: "2025-09-16T10:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Template not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    patch:
      tags: [ Notification templates ]
      summary: Update template (admin)
      operationId: adminUpdateTemplate
      parameters:
        - name: templateUuid
          in: path
          required: true
          description: Public UUID of the template
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationTemplatePatchRequest'
            examples:
              patchTitle:
                value:
                  title: "Outage alert v2"
              patchBodyAndChannel:
                value:
                  body: "Hi {{name}}, outage in {{city}} since {{time}}. We are on it."
                  channel: "sms"
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationTemplateResponse'
              examples:
                updated:
                  value:
                    notificationTemplateUuid: "3f2b7a9c-1d4e-4f7a-9c2b-5a6d7e8f9a0b"
                    title: "Outage alert v2"
                    body: "Hi {{name}}, outage in {{city}} since {{time}}. We are on it."
                    channel: "sms"
                    createdByAccountUuid: "9a8b7c6d-5e4f-3a2b-1c0d-ef1234567890"
                    createdAt: "2025-09-16T10:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Template not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    delete:
      tags: [ Notification templates ]
      summary: Delete template (admin)
      operationId: adminDeleteTemplate
      parameters:
        - name: templateUuid
          in: path
          required: true
          description: Public UUID of the template
          schema: { type: string }
      responses:
        '204':
          description: Deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Template not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /templates/{templateUuid}/targets/{groupUuid}:
    put:
      tags: [ Template targeting ]
      summary: Assign template to group (admin)
      operationId: adminAssignTemplateToGroup
      parameters:
        - name: templateUuid
          in: path
          required: true
          description: Public UUID of the template
          schema: { type: string }
        - name: groupUuid
          in: path
          required: true
          description: Public UUID of the group
          schema: { type: string }
      responses:
        '201':
          description: Targeting created
          headers:
            Location:
              description: URL of the targeting resource
              schema: { type: string }
              example: /templates/3f2b7a9c-1d4e-4f7a-9c2b-5a6d7e8f9a0b/targets/9d5f1c2b-7a30-4e1a-bc88-2f4a6b7c8d90
        '200':
          description: Already targeted (idempotent)
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Template or group not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    head:
      tags: [ Template targeting ]
      summary: Check if template targets group (admin)
      operationId: adminCheckTemplateTargeting
      parameters:
        - name: templateUuid
          in: path
          required: true
          description: Public UUID of the template
          schema: { type: string }
        - name: groupUuid
          in: path
          required: true
          description: Public UUID of the group
          schema: { type: string }
      responses:
        '200':
          description: Targeting exists
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Template, group, or targeting not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

    delete:
      tags: [ Template targeting ]
      summary: Remove template targeting from group (admin)
      operationId: adminRemoveTemplateTargeting
      parameters:
        - name: templateUuid
          in: path
          required: true
          description: Public UUID of the template
          schema: { type: string }
        - name: groupUuid
          in: path
          required: true
          description: Public UUID of the group
          schema: { type: string }
      responses:
        '204':
          description: Targeting deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Template or group not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }

  /templates/{templateUuid}/targets:
    get:
      tags: [ Template targeting ]
      summary: List groups targeted by template (admin)
      operationId: adminListTemplateTargets
      parameters:
        - name: templateUuid
          in: path
          required: true
          description: Public UUID of the template
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateTargetsForAdminResponse'
              examples:
                ok:
                  value:
                    - id: 12
                      contactGroupUuid: "9d5f1c2b-7a30-4e1a-bc88-2f4a6b7c8d90"
                      name: "On-call Team"
                      description: "Primary incident responders"
                      createdByAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                      createdAt: "2025-09-16T10:00:00Z"
                    - id: 13
                      contactGroupUuid: "1c2b3d4e-5f67-489a-b0c1-2d3e4f5a6b7c"
                      name: "SRE"
                      description: "Site Reliability Engineering"
                      createdByAccountUuid: "2a1e9b6c-6c79-4d23-9f2a-1d0c7cc2d4f8"
                      createdAt: "2025-09-16T11:00:00Z"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                unauthorized: { $ref: '#/components/examples/Unauthorized' }
        '403':
          description: Forbidden
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                forbidden: { $ref: '#/components/examples/Forbidden' }
        '404':
          description: Template not found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                notFound: { $ref: '#/components/examples/NotFound' }
        '500':
          description: Internal error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
              examples:
                internal: { $ref: '#/components/examples/InternalError' }


security:
  - bearerAuth: []